# dnSpy

## 下载地址

https://github.com/dnSpy/dnSpy

![](E:\Notes\dnSpy\img\1709952368248.jpg)

## 一、如何在没有第三方.NET库源码的情况，调试第三库代码？

1. 进入 `Debug` 目录，并运行 `WinFormsApp1.exe`（**不要直接在 `VS2022` 中，运行应用程序，不然在 `dnSpy` 附加到进程中会报错：其他程序正在调试进程**）

![](E:\Notes\dnSpy\img\1709953473199.jpg)

2. 把欲调试的程序集（`ClassLibrary1.dll`） 拖入到 `dnSpy`，并设置断点，**我们假设没有 `ClassLibrary1.dll` 的源码**
3. 可以看到反编译后的代码，**反编译出来的方法定义会和第三方源码可能不同**，以下是一些可能导致不同反编译结果的因素：
   * **编译器优化**：不同版本的编译器可能会对代码进行不同的优化，例如使用不同的算法、数据结构或者代码重排等。这些优化可能会导致反编译出来的代码结构和顺序不同，本文示例使用 `.NET 6` 开发，`.NET Framework` 编译的库可能反编译出来与源码几乎一致
   * **反编译工具更新**：`dnSpy` 本身也会不断更新，以适应新的 `.NET` 版本和编译器特性。这些更新可能会改变反编译算法和策略，从而导致不同版本的 `dnSpy` 反编译结果不一致

![](E:\Notes\dnSpy\img\1709953968518.jpg)

3. 在 `dnSpy` 中点击 `调试->附加到进程（Ctrl+Alt+P）`，并搜索应用程序名称（`Form1`），点击 `附加`

![](E:\Notes\dnSpy\img\1709954128810.jpg)

4. 在应用程序中，点击按钮，命中断点

![](E:\Notes\dnSpy\img\1709954227405.jpg)

## 二、如何调试.NET自身库方法

方法类似，找到 `.NET` 库对应类、对应方法，运行目标程序，然后打断点（`.NET` 库方法这样找：点击【文件】》【从GAC打开】=》搜索目标库，双击库，再查找目标方法，后面调试步骤就是一样了）

## 三、无需源码也能修改.NET程序集

在 `ClassLibrary1.dll` 中，如果我们想要让 `GetNumStr` 方法不返回 `456`，返回 `hello`

1. 右键，点击 `编辑方法（C#）`

![](E:\Notes\dnSpy\img\1709956929254.jpg)

2. 修改代码，点击 `编译` 按钮
3. `文件->保存模块->确定` 保存修改后的程序集

![](E:\Notes\dnSpy\img\1709959131386.jpg)