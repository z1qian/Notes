# C#9 源代码生成器

* 这不是对 C# 语法的增强，而是对编译过程的增强，在编译过程中，可以生成 C# 源代码，并把它们添加到项目中
* 除了在运行期间使用反射，还可以使用源代码生成器，它可以在编译期间读取特性，并根据这些特性生成代码，这些代码也会在构建应用程序期间被编译，从而降低对反射的需求

## Hello，World 源代码生成器

* 它需要是一个 NETStandard2.0 库

* 添加 NuGet 包

  1.  Microsoft.CodeAnalysis.Analyzers
  2.  Microsoft.CodeAnalysis.CSharp

* 源代码生成器类需要实现 ISoureeiencrator 接口，并应用Generator特性

  ```c#
   [Generator]
   public class HelloWorldGenerator : ISourceGenerator
   {
       /// <summary>
  	/// Execute 完成生成器的主要工作
  	/// </summary>
  	/// <param name="context">用于在编译过程中访问语法树，这里可以访问使用了源代码生成器的代码，以便进行修改或者扩展</param>
       public void Execute(GeneratorExecutionContext context)
       {}
  
       /// <summary>
       /// 在启动代码生成之前，先调用 Initialize 方法
       /// </summary>
       public void Initialize(GeneratorInitializationContext context)
       {}
   }
  ```

* 要在项目中使用源代码生成器，需要添加 Analyzer 元素并引用这个库

  ```c#
  <ItemGroup>
  	<ProjectReference Include="..\HelloWorldGenerator\HelloWorldGenerator.csproj"  OutputItemType="Analyzer"
                    ReferenceOutputAssembly="false"/>
  </ItemGroup>
  ```

  